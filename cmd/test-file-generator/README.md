# æˆæƒæ–‡ä»¶æµ‹è¯•ç”Ÿæˆå™¨

è¿™ä¸ªå·¥å…·ç”¨äºç”Ÿæˆæµ‹è¯•æ–‡ä»¶ï¼ŒéªŒè¯æˆæƒç³»ç»Ÿçš„åŠŸèƒ½ã€‚

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

### æ–‡ä»¶ç±»å‹
- **`.bind`** - è®¾å¤‡ç»‘å®šè¯·æ±‚æ–‡ä»¶ï¼ˆåŠ å¯†ç‰ˆæœ¬ï¼Œå¯ç›´æ¥ç”¨äºAPIï¼‰
- **`.unbind`** - è®¾å¤‡è§£ç»‘æ–‡ä»¶ï¼ˆåŠ å¯†ç‰ˆæœ¬ï¼‰
- **`.bind.json/.unbind.json`** - å¯¹åº”çš„æ˜æ–‡ç‰ˆæœ¬ï¼ˆç”¨äºè°ƒè¯•ï¼‰

### åŠ å¯†æœºåˆ¶
- ğŸ”’ **å®¢æˆ·ç«¯AESå¯†é’¥**: bindæ–‡ä»¶ä½¿ç”¨åŸºäºæœºå™¨IDç”Ÿæˆçš„å›ºå®šAESå¯†é’¥è¿›è¡Œæ··åˆåŠ å¯†
- ğŸ“¡ **çœŸå®åŠ å¯†**: è‡ªåŠ¨ä»è¿è¡Œä¸­çš„æœåŠ¡å™¨è·å–å…¬é’¥ï¼Œä½¿ç”¨æ··åˆåŠ å¯†ï¼ˆRSA+AESï¼‰
- ğŸ”„ **æ™ºèƒ½å›é€€**: å¦‚æœæœåŠ¡å™¨æœªè¿è¡Œï¼Œè‡ªåŠ¨å›é€€åˆ°æ¨¡æ‹ŸåŠ å¯†
- âœ… **APIå…¼å®¹**: ç”Ÿæˆçš„åŠ å¯†æ–‡ä»¶å¯ç›´æ¥ç”¨äºæˆæƒAPIæ¥å£

## ğŸ“– ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬å‘½ä»¤

```bash
# ç”Ÿæˆbindæ–‡ä»¶ï¼ˆé»˜è®¤1ä¸ªï¼‰
go run cmd/test-file-generator/main.go generate-bind

# ç”Ÿæˆå¤šä¸ªbindæ–‡ä»¶
go run cmd/test-file-generator/main.go generate-bind 3

# æ ¹æ®licenseæ–‡ä»¶ç”Ÿæˆunbindæ–‡ä»¶ï¼ˆæ˜æ–‡ç‰ˆæœ¬ï¼‰
go run cmd/test-file-generator/main.go generate-unbind test_data/TEST-PC-01.license.json

# æ ¹æ®åŠ å¯†licenseæ–‡ä»¶ç”Ÿæˆunbindæ–‡ä»¶ï¼ˆéœ€è¦AESå¯†é’¥ï¼‰
go run cmd/test-file-generator/main.go generate-unbind test_data/TEST-PC-01.license dGVzdF9hZXNfa2V5XzEyMzQ1Njc4

# æ ¹æ®æœºå™¨IDç”Ÿæˆå¯¹åº”çš„AESå¯†é’¥
go run cmd/test-file-generator/main.go generate-aes-key abc123def456

# æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
go run cmd/test-file-generator/main.go help
```

## ğŸ“ æ–‡ä»¶ç»“æ„

æ‰€æœ‰ç”Ÿæˆçš„æ–‡ä»¶ä¿å­˜åœ¨ `test_data/` ç›®å½•ä¸‹ï¼š

```
test_data/
â”œâ”€â”€ TEST-PC-01.bind          # åŠ å¯†çš„ç»‘å®šæ–‡ä»¶ (ç”¨äºAPI)
â”œâ”€â”€ TEST-PC-01.bind.json     # æ˜æ–‡çš„ç»‘å®šæ–‡ä»¶ (ç”¨äºè°ƒè¯•)
â”œâ”€â”€ TEST-PC-01.unbind        # åŠ å¯†çš„è§£ç»‘æ–‡ä»¶
â””â”€â”€ TEST-PC-01.unbind.json   # æ˜æ–‡çš„è§£ç»‘æ–‡ä»¶
```

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### generate-bind åŠŸèƒ½
- ç”Ÿæˆè™šæ„çš„æœºå™¨ä¿¡æ¯ï¼ˆä¸»æœºåã€æœºå™¨IDï¼‰
- æ”¯æŒæŒ‡å®šç”Ÿæˆæ•°é‡
- åŒæ—¶ç”ŸæˆåŠ å¯†å’Œæ˜æ–‡ç‰ˆæœ¬
- åŠ å¯†ç‰ˆæœ¬ä½¿ç”¨åŸºäºæœºå™¨IDçš„å›ºå®šAESå¯†é’¥ï¼ˆç¬¦åˆå®¢æˆ·ç«¯å®é™…è¡Œä¸ºï¼‰

### generate-unbind åŠŸèƒ½
- è¯»å–å·²æœ‰çš„licenseæ–‡ä»¶ï¼ˆæ”¯æŒ .license.json æ˜æ–‡å’Œ .license åŠ å¯†æ ¼å¼ï¼‰
- å¯¹äºåŠ å¯†æ–‡ä»¶ï¼Œæ”¯æŒä¼ å…¥Base64ç¼–ç çš„AESå¯†é’¥è¿›è¡Œè§£å¯†
- æå–å…¶ä¸­çš„æœºå™¨ä¿¡æ¯å’Œè§£ç»‘ç§é’¥
- ä½¿ç”¨ç§é’¥ç”ŸæˆçœŸå®çš„è§£ç»‘è¯æ˜ç­¾å
- ç”Ÿæˆæ ¼å¼æ­£ç¡®çš„unbindæ–‡ä»¶

### generate-aes-key åŠŸèƒ½
- æ ¹æ®æœºå™¨IDç”Ÿæˆå¯¹åº”çš„å®¢æˆ·ç«¯AESå¯†é’¥
- ä½¿ç”¨é¡¹ç›®æ ‡å‡†ç®—æ³•ï¼šSHA256("LicenseCenter:AES:" + machineID)
- è¾“å‡ºBase64ç¼–ç çš„å¯†é’¥ï¼Œå¯ç›´æ¥ç”¨äºè§£å¯†licenseæ–‡ä»¶
- å¸®åŠ©ç”¨æˆ·å¿«é€Ÿè·å–æ­£ç¡®çš„AESå¯†é’¥

### åŠ å¯†æµç¨‹
1. ä» `http://localhost:8080/api/public-key` è·å–æœåŠ¡å™¨å…¬é’¥
2. åŸºäºæœºå™¨IDç”Ÿæˆå®¢æˆ·ç«¯å›ºå®šAESå¯†é’¥ï¼š`SHA256("LicenseCenter:AES:" + machineID)`
3. ä½¿ç”¨å®¢æˆ·ç«¯AESå¯†é’¥è¿›è¡Œæ··åˆåŠ å¯†ï¼ˆRSA+AESï¼‰
4. å°†åŠ å¯†ç»“æœè¿›è¡ŒBase64ç¼–ç å­˜å‚¨

### æ•°æ®æ ¼å¼
ç”Ÿæˆçš„æµ‹è¯•æ•°æ®åŒ…å«çœŸå®çš„å­—æ®µï¼š
- **machine_id**: 32ä½MD5æ ¼å¼çš„æœºå™¨æ ‡è¯†
- **hostname**: æ¨¡æ‹Ÿçš„ä¸»æœºå
- **request_time**: å½“å‰æ—¶é—´æˆ³
- **unbind_proof**: ä½¿ç”¨licenseä¸­ç§é’¥ç”Ÿæˆçš„çœŸå®ç­¾å

### AESå¯†é’¥æ”¯æŒ
å¯¹äºåŠ å¯†çš„ `.license` æ–‡ä»¶ï¼š
- éœ€è¦æä¾›å®¢æˆ·ç«¯ç”Ÿæˆbindæ–‡ä»¶æ—¶ä½¿ç”¨çš„AESå¯†é’¥
- è¿™ä¸ªå¯†é’¥æ˜¯å®¢æˆ·ç«¯åœ¨è¯·æ±‚æˆæƒæ—¶ä¼ é€’ç»™æœåŠ¡å™¨çš„32å­—èŠ‚AES-256å¯†é’¥
- å¯†é’¥å¿…é¡»ä½¿ç”¨Base64ç¼–ç ä¼ é€’
- æ”¯æŒAES-GCMè§£å¯†æ¨¡å¼
- å¦‚æœä¸æä¾›å¯†é’¥ï¼Œä¼šå°è¯•é€šè¿‡APIè§£å¯†ï¼ˆæš‚æœªå®ç°ï¼‰

**å¯†é’¥æ ¼å¼ç¤ºä¾‹**:
```bash
# æ–¹æ³•1ï¼šä½¿ç”¨å†…ç½®å·¥å…·ç”Ÿæˆï¼ˆæ¨èï¼‰
go run cmd/test-file-generator/main.go generate-aes-key abc123def456
# è¾“å‡º: kVoij8U0PFXMnnyVXl9bPwNEoN0jZ4MTm9yQslqtUrA=

# æ–¹æ³•2ï¼šæ‰‹åŠ¨è®¡ç®—ï¼ˆç”¨äºç†è§£ç®—æ³•ï¼‰
echo -n "LicenseCenter:AES:abc123def456" | shasum -a 256 | cut -d' ' -f1 | xxd -r -p | base64

# ä½¿ç”¨ç”Ÿæˆçš„AESå¯†é’¥è§£å¯†licenseæ–‡ä»¶
go run cmd/test-file-generator/main.go generate-unbind test_data/encrypted.license kVoij8U0PFXMnnyVXl9bPwNEoN0jZ4MTm9yQslqtUrA=
```

## ğŸ§ª æµ‹è¯•éªŒè¯

### å‰ç½®æ¡ä»¶
1. æœåŠ¡å™¨è¿è¡Œåœ¨ `localhost:8080`
2. æœ‰å¯ç”¨çš„license.jsonæ–‡ä»¶ï¼ˆç”¨äºç”Ÿæˆunbindï¼‰

### éªŒè¯æ­¥éª¤
```bash
# 1. å¯åŠ¨æœåŠ¡å™¨
go run cmd/server/main.go

# 2. ç”Ÿæˆæµ‹è¯•bindæ–‡ä»¶
go run cmd/test-file-generator/main.go generate-bind

# 3. å¦‚æœæœ‰licenseæ–‡ä»¶ï¼Œç”Ÿæˆunbindæ–‡ä»¶
go run cmd/test-file-generator/main.go generate-unbind test_data/æŸä¸ª.license.json
```

## ğŸ› æ•…éšœæ’é™¤

### æ— æ³•è·å–å…¬é’¥
**é—®é¢˜**: æ˜¾ç¤º "æ— æ³•è·å–æœåŠ¡å™¨å…¬é’¥ï¼Œä½¿ç”¨æ¨¡æ‹ŸåŠ å¯†"
**è§£å†³**: ç¡®ä¿æœåŠ¡å™¨è¿è¡Œåœ¨ `localhost:8080`

### è§£ælicenseæ–‡ä»¶å¤±è´¥
**é—®é¢˜**: æ— æ³•è§£ælicenseæ–‡ä»¶
**è§£å†³**: 
1. å¯¹äºæ˜æ–‡æ–‡ä»¶ï¼Œç¡®ä¿ä½¿ç”¨ `.license.json` æ ¼å¼å¹¶éªŒè¯JSONæ ¼å¼
2. å¯¹äºåŠ å¯†æ–‡ä»¶ï¼Œç¡®ä¿æä¾›å®¢æˆ·ç«¯ç”Ÿæˆbindæ–‡ä»¶æ—¶ä½¿ç”¨çš„æ­£ç¡®AESå¯†é’¥ï¼ˆBase64ç¼–ç ï¼‰
3. éªŒè¯AESå¯†é’¥é•¿åº¦æ˜¯å¦æ­£ç¡®ï¼ˆéœ€è¦32å­—èŠ‚ç”¨äºAES-256ï¼‰

### ç­¾åç”Ÿæˆå¤±è´¥
**é—®é¢˜**: ç”Ÿæˆè§£ç»‘è¯æ˜å¤±è´¥
**è§£å†³**: 
1. æ£€æŸ¥licenseæ–‡ä»¶ä¸­æ˜¯å¦åŒ…å« `unbind_private_key` å­—æ®µ
2. éªŒè¯ç§é’¥æ ¼å¼æ˜¯å¦æ­£ç¡®

## ğŸ“ æ³¨æ„äº‹é¡¹

- åŠ å¯†æ–‡ä»¶åªèƒ½ç”±æ‹¥æœ‰å¯¹åº”ç§é’¥çš„æœåŠ¡å™¨è§£å¯†
- æ˜æ–‡æ–‡ä»¶ä»…ç”¨äºè°ƒè¯•ï¼Œä¸åº”åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨
- ç”Ÿæˆunbindæ–‡ä»¶éœ€è¦ä½¿ç”¨licenseä¸­çš„çœŸå®ç§é’¥
- æ¯æ¬¡ç”Ÿæˆbindæ–‡ä»¶éƒ½ä¼šäº§ç”Ÿä¸åŒçš„æœºå™¨IDå’Œæ—¶é—´æˆ³
- æ”¯æŒè§£ææ˜æ–‡çš„ `.license.json` æ–‡ä»¶å’ŒåŠ å¯†çš„ `.license` æ–‡ä»¶
- è§£å¯†åŠ å¯†licenseæ–‡ä»¶éœ€è¦æä¾›å®¢æˆ·ç«¯ç”Ÿæˆbindæ–‡ä»¶æ—¶ä½¿ç”¨çš„AESå¯†é’¥ï¼ˆBase64ç¼–ç ï¼‰

## æŠ€æœ¯å®ç°

- ä½¿ç”¨ `crypto/md5` ç”Ÿæˆæœºå™¨ID
- ä½¿ç”¨é¡¹ç›®ä¸­çš„ `pkg/crypto` åŒ…è¿›è¡ŒRSAç­¾å
- ä½¿ç”¨ `encoding/base64` è¿›è¡ŒBase64ç¼–ç 
- ä½¿ç”¨ `encoding/json` è¿›è¡ŒJSONåºåˆ—åŒ–
- ç¬¦åˆé¡¹ç›®ç°æœ‰çš„æ–‡ä»¶æ ¼å¼è§„èŒƒ 